# Note: YAML does not allow Tabs for indentation!

language: java
env:
  - ARSNOVA_SENCHA_CMD_VERSION="4.0.4.84"
services:
  - couchdb
before_install:
  # Install Sencha Command (taken from deftjs/DeftJS)
  - "wget http://cdn.sencha.com/cmd/$ARSNOVA_SENCHA_CMD_VERSION/SenchaCmd-$ARSNOVA_SENCHA_CMD_VERSION-linux-x64.run.zip"
  - "unzip -q SenchaCmd-$ARSNOVA_SENCHA_CMD_VERSION-linux-x64.run.zip"
  - "chmod +x SenchaCmd-$ARSNOVA_SENCHA_CMD_VERSION-linux-x64.run"
  - "./SenchaCmd-$ARSNOVA_SENCHA_CMD_VERSION-linux-x64.run --mode unattended"
  # Add Sencha Command to PATH
  - "export PATH=~/bin/Sencha/Cmd/$ARSNOVA_SENCHA_CMD_VERSION/:$PATH"
  # Download ARSnova-war, CouchDB init
  - "git clone https://github.com/thm-projects/arsnova-war"
  - "git clone https://github.com/thm-projects/setuptool"
before_script:
  # Setup CouchDB
  - "sudo mkdir /etc/arsnova"
  - "sudo cp arsnova-war/src/main/webapp/arsnova.properties.example /etc/arsnova/arsnova.properties"
  - "cd setuptool"
  - "python tool.py"
  - "cd .."
script:
  # Build ARSnova with production settings
  - "mvn install"
  - "mvn -f arsnova-war install"
  # Run Server
  - "cd arsnova-war"
  - "mvn jetty:run -Dmobile.path=../src/main/webapp/build/production/ARSnova/ &"
  - "sleep 3"
  - "cd .."
  - "ruby src/test/saucelabs.rb"
notifications:
  slack: f112a:GOZb6ewuAf2AVxduDXzdiCTG
  email: admin@ecollab.eu

addons:
  sauce_connect:
    username: "commana-mni"
    access_key:
      secure: "aRIa42mm6gKzQriTaf8X4wmU1UsMIaFrDs/1uApOwEFd9UlmNRVCkByGoB8y0Hfn91VuO3SwQ7vrwAmXBc2pCe8cx8QJBc+lqA7hdBQuMwOfLIpCo2b6gKcpPEflvP2ZMxqVrVnqb6RVlD64diM/m6LM9g5/ncE10w8A3M4PPEE="
